<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Five Queens Jewelry — Shop</title>
  <meta name="description" content="Five Queens Jewelry — demo e‑commerce storefront with user accounts, orders, and monthly best‑seller report." />
  <style>
    :root{--accent:#b76e79;--muted:#6b6b6b;--bg:#fffdfb;--card:#fff;--shadow:0 6px 18px rgba(16,24,40,0.08);--radius:12px;--max:1100px}
    *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#fff 0%,#fffdfb 100%);color:#111}
    a{color:inherit;text-decoration:none}img{max-width:100%;display:block}
    .container{max-width:var(--max);margin:0 auto;padding:16px}
    header{position:sticky;top:0;background:rgba(255,255,255,0.95);backdrop-filter:blur(6px);box-shadow:var(--shadow);z-index:40}
    .nav{height:64px;display:flex;align-items:center;gap:12px;padding:8px 16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ffd6e0,#b76e79);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    .search{flex:1} .search input{width:100%;padding:10px;border-radius:10px;border:1px solid #eee}
    .icons{display:flex;gap:8px}
    .icon-btn{padding:8px 10px;border-radius:10px;border:1px solid #eee;background:#fff;cursor:pointer}

    main{padding:18px}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow)}
    .products{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media(max-width:1100px){.products{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){.products{grid-template-columns:1fr}}
    .product{border-radius:12px;overflow:hidden;border:1px solid #f3e3e8;background:linear-gradient(180deg,#fff,#fff7f9)}
    .product .image{height:220px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#fff,#fff7f9)}
    .body{padding:12px}
    .price{font-weight:700;color:var(--accent)}
    .btn{padding:8px 12px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer}
    .chip{padding:8px 10px;border-radius:999px;border:1px solid #eee;background:#fff;cursor:pointer}

    .cart-drawer{position:fixed;right:16px;bottom:18px;width:360px;max-width:calc(100% - 32px);border-radius:14px;background:linear-gradient(180deg,#fff,#fffdfb);box-shadow:0 18px 40px rgba(10,10,10,0.12);padding:12px;display:none}
    .cart-item{display:flex;gap:12px;align-items:center;padding:8px 0;border-bottom:1px dashed #f3eaea}

    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{background:var(--card);border-radius:12px;max-width:940px;width:100%;box-shadow:var(--shadow);display:flex;gap:12px;overflow:hidden}
    .modal .left{flex:1;padding:18px}.modal .right{width:320px;padding:18px}

    footer{padding:24px;text-align:center;color:var(--muted)}
    .muted{color:var(--muted)}
    .center{text-align:center}
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select,textarea{padding:8px;border-radius:8px;border:1px solid #eee;width:100%}
    small{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="nav container">
      <div class="brand">
        <div class="logo">FQ</div>
        <div>
          <div style="font-weight:700">Five Queens Jewelry</div>
          <div style="font-size:12px;color:var(--muted)">Shine with the elegance of a Queen</div>
        </div>
      </div>

      <div class="search">
        <input id="searchInput" placeholder="Search jewelry, e.g. necklace, ring..." />
      </div>

      <div class="icons">
        <div class="icon-btn" id="openAuthBtn">Login / Register</div>
        <div class="icon-btn" id="openAdmin">Admin</div>
        <div class="icon-btn" id="openReport">Monthly Best</div>
        <div class="icon-btn" id="openCartBtn">Cart (<span id="cartCount">0</span>)</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <aside class="card">
        <h3>Categories</h3>
        <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
          <div class="chip" data-cat="all">All</div>
          <div class="chip" data-cat="rings">Rings</div>
          <div class="chip" data-cat="necklaces">Necklaces</div>
          <div class="chip" data-cat="earrings">Earrings</div>
          <div class="chip" data-cat="bracelets">Bracelets</div>
        </div>

        <div style="height:12px"></div>

        <div>
          <h4>Profile</h4>
          <div id="profileArea" class="muted">Not logged in.</div>
          <div style="height:8px"></div>
          <div><button class="chip" id="openProfile">Edit Profile / Address</button></div>
          <div style="height:12px"></div>
          <h4>Cart Summary</h4>
          <div id="cartSummary">No items yet.</div>
          <div style="height:12px"></div>
          <button class="btn" id="checkoutBtn">Proceed to Checkout</button>
        </div>
      </aside>

      <section>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <h2>Featured</h2>
          <div class="muted">Wear your confidence. Wear your crown.</div>
        </div>

        <div id="products" class="products"></div>
      </section>
    </div>

    <div style="margin-top:18px" id="userOrdersSection"></div>
  </main>

  <!-- cart drawer -->
  <div id="cartDrawer" class="cart-drawer">
    <h3>Cart</h3>
    <div id="cartItems"></div>
    <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
      <div><strong>Total:</strong> ₱<span id="cartTotal">0</span></div>
      <div><button class="btn" id="buyNow">Buy Now</button></div>
    </div>
  </div>

  <!-- product modal -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="left">
        <div id="modalImage" style="height:340px;display:flex;align-items:center;justify-content:center">Image</div>
      </div>
      <div class="right">
        <h3 id="modalTitle">Title</h3>
        <div class="price" id="modalPrice">₱0</div>
        <div class="meta" id="modalCategory">Category</div>
        <p id="modalDesc" class="muted">Description</p>
        <div style="height:12px"></div>
        <div style="display:flex;gap:8px">
          <input id="qty" type="number" value="1" min="1" style="width:70px;padding:8px;border-radius:8px;border:1px solid #eee" />
          <button class="btn" id="addToCartBtn">Add to cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- auth modal (register/login) -->
  <div id="authModal" class="modal-backdrop">
    <div class="modal" style="max-width:720px;flex-direction:column;padding:18px">
      <h3 id="authTitle">Login or Register</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <h4>Register</h4>
          <label>Full name</label><input id="regName" />
          <label>Email</label><input id="regEmail" type="email" />
          <label>Password</label><input id="regPass" type="password" />
          <label>Phone</label><input id="regPhone" />
          <label>Address</label><textarea id="regAddress" rows="3"></textarea>
          <div style="height:8px"></div>
          <button class="btn" id="doRegister">Create account</button>
          <small>Accounts are stored locally for demo only.</small>
        </div>
        <div style="flex:1;min-width:260px">
          <h4>Login</h4>
          <label>Email</label><input id="loginEmail" type="email" />
          <label>Password</label><input id="loginPass" type="password" />
          <div style="height:8px"></div>
          <button class="btn" id="doLogin">Login</button>
          <div style="height:8px"></div>
          <div class="muted">If you registered before on this browser you'll remain logged in. No external servers are used in this demo.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- profile modal -->
  <div id="profileModal" class="modal-backdrop">
    <div class="modal" style="max-width:720px;flex-direction:column;padding:18px">
      <h3>Profile / Shipping</h3>
      <label>Full name</label><input id="profileName" />
      <label>Email (readonly)</label><input id="profileEmail" readonly />
      <label>Phone</label><input id="profilePhone" />
      <label>Address</label><textarea id="profileAddress" rows="3"></textarea>
      <div style="height:8px"></div>
      <button class="btn" id="saveProfile">Save Profile</button>
      <div style="height:8px"></div>
      <button class="chip" id="logoutBtn">Logout</button>
    </div>
  </div>

  <!-- admin modal -->
  <div id="adminModal" class="modal-backdrop">
    <div class="modal" style="max-width:1000px;flex-direction:column;padding:18px">
      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <h3>Admin — Orders & Sales</h3>
          <p class="muted">Record demo sales, view and change order status (pending → paid → delivered).</p>
          <label>Pick product to simulate sale</label>
          <select id="adminProduct"></select>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="adminQty" type="number" value="1" style="width:120px" />
            <input id="adminMonth" type="month" />
            <button class="btn" id="recordSale">Record Sale</button>
          </div>

          <div style="height:12px"></div>
          <h4>Recent simulated orders</h4>
          <div id="adminOrders"></div>
        </div>
        <div style="width:360px">
          <h4>Order Management</h4>
          <label>Filter</label>
          <select id="adminFilter"><option value="all">All</option><option value="pending">Pending</option><option value="paid">Paid</option><option value="delivered">Delivered</option></select>
          <div style="height:8px"></div>
          <div id="adminOrderList" style="max-height:420px;overflow:auto"></div>
          <div style="height:12px"></div>
          <button class="chip" id="exportData">Export JSON</button>
          <button class="chip" id="resetData">Reset Orders & Sales</button>
        </div>
      </div>
    </div>
  </div>

  <!-- report modal -->
  <div id="reportModal" class="modal-backdrop">
    <div class="modal" style="max-width:900px;flex-direction:column;padding:18px">
      <h3>Monthly Best Sellers</h3>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
        <label>Choose month</label>
        <input id="reportMonth" type="month" />
      </div>
      <div id="reportContent"></div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div style="font-weight:700">Five Queens Jewelry</div>
      <div class="muted">Demo storefront — no real payments. Data stored locally (localStorage).</div>
    </div>
  </footer>

  <script>
    // ---------- Demo products ----------
    const demoProducts = [

      <!-- ===== PRODUCTS LIST ===== -->
<section class="products">

  <!-- PRODUCT 1 -->
  <div class="product-card">
    <img src="Royal Pearl Necklace.jpg" alt="Royal Pearl Necklace">
    <h3>Royal Pearl Necklace</h3>
    <p class="price">₱2599</p>
    <button onclick="addToCart('Royal Pearl Necklace',2599,'Royal Pearl Necklace.jpg')">
      Add to Cart
    </button>
  </div>

  <!-- PRODUCT 2 -->
  <div class="product-card">
    <img src="Queens Halo Ring.png" alt="Queens Halo Ring">
    <h3>Queens Halo Ring</h3>
    <p class="price">₱1,899</p>
    <button onclick="addToCart('Queens Halo Ring',1899,'Queens Halo Ring.png')">
      Add to Cart
    </button>
  </div>

  <!-- PRODUCT 3 -->
  <div class="product-card">
    <img src="Luxe Pearl Studs.png" alt="Luxe Pearl Studs">
    <h3>Luxe Pearl Studs</h3>
    <p class="price">₱799</p>
    <button onclick="addToCart('Luxe Pearl Studs',799,'Luxe Pearl Studs.png')">
      Add to Cart
    </button>
  </div>

  <!-- PRODUCT 4 -->
  <div class="product-card">
    <img src="Rose Gold Bangle" alt="Rose Gold Bangle.png">
    <h3>Rose Gold Bangle</h3>
    <p class="price">₱799</p>
    <button onclick="addToCart('Rose Gold Bangle',1299,'Rose Gold Bangle.png')">
      Add to Cart
    </button>
  </div>

        <!-- PRODUCT 5 -->
  <div class="product-card">
    <img src="Emerald Drop Earrings" alt="Rose Gold Bangle.png">
    <h3>Emerald Drop Earrings</h3>
    <p class="price">₱2199</p>
    <button onclick="addToCart('Emerald Drop Earrings',2199,'Rose Gold Bangle.png')">
      Add to Cart
    </button>
  </div>

        <!-- PRODUCT 6 -->
  <div class="product-card">
    <img src="Silver Minimalist Ring" alt="Rose Gold Bangle.png">
    <h3>Silver Minimalist Ring</h3>
    <p class="price">₱699</p>
    <button onclick="addToCart('Silver Minimalist Ring',699,'Rose Gold Bangle.png')">
      Add to Cart
    </button>
  </div>

              <!-- PRODUCT 7 -->
  <div class="product-card">
    <img src="Amethyst Pendant" alt="Rose Gold Bangle.png">
    <h3>Amethyst Pendant</h3>
    <p class="price">₱1499</p>
    <button onclick="addToCart('Amethyst Pendant',1499,'Rose Gold Bangle.png')">
      Add to Cart
    </button>
  </div>

              <!-- PRODUCT 8 -->
  <div class="product-card">
    <img src="Stackable Ring Set" alt="Rose Gold Bangle.png">
    <h3>Stackable Ring Set</h3>
    <p class="price">₱1199</p>
    <button onclick="addToCart('Stackable Ring Set',1199,'Rose Gold Bangle.png')">
      Add to Cart
    </button>
  </div>

</section>
    ];

    // ---------- LocalStorage keys ----------
    const KEY_PRODUCTS = 'fq_products_v1';
    const KEY_USERS = 'fq_users_v1';
    const KEY_CURRENT_USER = 'fq_current_user_v1';
    const KEY_ORDERS = 'fq_orders_v1';
    const KEY_MONTH_SALES = 'fq_month_sales_v1';
    const KEY_CART = 'fq_cart_demo_v1';

    // ---------- Helpers ----------
    function uid(len=8){return Math.random().toString(36).slice(2,2+len)}
    function money(n){return Number(n).toLocaleString('en-PH')}
    function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
    function load(key,def){try{return JSON.parse(localStorage.getItem(key))||def}catch(e){return def}}

    // ---------- Initialize ----------
    function initData(){
      if(!localStorage.getItem(KEY_PRODUCTS)) save(KEY_PRODUCTS, demoProducts);
      if(!localStorage.getItem(KEY_USERS)) save(KEY_USERS, []);
      if(!localStorage.getItem(KEY_ORDERS)) save(KEY_ORDERS, []);
      if(!localStorage.getItem(KEY_MONTH_SALES)) save(KEY_MONTH_SALES, {});
    }
    initData();

    let dataProducts = load(KEY_PRODUCTS, demoProducts);
    let users = load(KEY_USERS, []);
    let orders = load(KEY_ORDERS, []);
    let monthSales = load(KEY_MONTH_SALES, {});
    let cart = load(KEY_CART, {}); // {p1:{qty:2}}
    let currentUser = load(KEY_CURRENT_USER, null); // {id,name,email,phone,address}

    // ---------- Auth UX ----------
    const authModal = document.getElementById('authModal');
    const profileModal = document.getElementById('profileModal');
    const openAuthBtn = document.getElementById('openAuthBtn');
    const openProfile = document.getElementById('openProfile');

    function updateProfileArea(){
      const el = document.getElementById('profileArea');
      if(currentUser){
        el.innerHTML = `<div style="font-weight:700">${currentUser.name}</div><div class="muted">${currentUser.email}</div>`;
      } else el.textContent = 'Not logged in.';
    }
    updateProfileArea();

    openAuthBtn.addEventListener('click',()=>{authModal.style.display='flex'})
    authModal.addEventListener('click',e=>{ if(e.target===authModal) authModal.style.display='none' })
    profileModal.addEventListener('click',e=>{ if(e.target===profileModal) profileModal.style.display='none' })

    document.getElementById('doRegister').addEventListener('click',()=>{
      const name = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim().toLowerCase();
      const pass = document.getElementById('regPass').value;
      const phone = document.getElementById('regPhone').value.trim();
      const address = document.getElementById('regAddress').value.trim();
      if(!name||!email||!pass){alert('Fill name, email and password');return}
      if(users.find(u=>u.email===email)){alert('Email already registered');return}
      const u = {id:uid(6),name,email,pass,phone,address};
      users.push(u); save(KEY_USERS,users);
      currentUser = {id:u.id,name:u.name,email:u.email,phone:u.phone,address:u.address}; save(KEY_CURRENT_USER,currentUser);
      authModal.style.display='none'; document.getElementById('regName').value=''; document.getElementById('regEmail').value=''; document.getElementById('regPass').value='';
      updateProfileArea(); alert('Account created and logged in');
    })

    document.getElementById('doLogin').addEventListener('click',()=>{
      const email = document.getElementById('loginEmail').value.trim().toLowerCase();
      const pass = document.getElementById('loginPass').value;
      const u = users.find(x=>x.email===email && x.pass===pass);
      if(!u){alert('Invalid credentials');return}
      currentUser = {id:u.id,name:u.name,email:u.email,phone:u.phone,address:u.address}; save(KEY_CURRENT_USER,currentUser);
      authModal.style.display='none'; updateProfileArea(); alert('Logged in');
    })

    // If a currentUser exists in localStorage, user remains logged in automatically.
    if(currentUser){updateProfileArea()}    

    document.getElementById('openProfile').addEventListener('click',()=>{
      if(!currentUser){ if(confirm('You are not logged in. Do you want to create an account or login?')){authModal.style.display='flex'} return }
      // populate
      document.getElementById('profileName').value = currentUser.name||'';
      document.getElementById('profileEmail').value = currentUser.email||'';
      document.getElementById('profilePhone').value = currentUser.phone||'';
      document.getElementById('profileAddress').value = currentUser.address||'';
      profileModal.style.display='flex';
    })

    document.getElementById('saveProfile').addEventListener('click',()=>{
      if(!currentUser){alert('Not logged in');return}
      currentUser.name = document.getElementById('profileName').value.trim();
      currentUser.phone = document.getElementById('profilePhone').value.trim();
      currentUser.address = document.getElementById('profileAddress').value.trim();
      // update users array
      const idx = users.findIndex(u=>u.id===currentUser.id);
      if(idx>-1){ users[idx].name=currentUser.name; users[idx].phone=currentUser.phone; users[idx].address=currentUser.address; save(KEY_USERS,users) }
      save(KEY_CURRENT_USER,currentUser); updateProfileArea(); profileModal.style.display='none'; alert('Profile saved');
    })

    document.getElementById('logoutBtn').addEventListener('click',()=>{
      if(confirm('Logout from this demo account?')){ localStorage.removeItem(KEY_CURRENT_USER); currentUser=null; updateProfileArea(); profileModal.style.display='none'; alert('Logged out') }
    })

    // ---------- Product rendering & search ----------
    const productsEl = document.getElementById('products');
    const searchInput = document.getElementById('searchInput');

    function renderProducts(filterCat='all',q=''){
      productsEl.innerHTML=''; const qlow=q.trim().toLowerCase();
      const list = dataProducts.filter(p=>{ if(filterCat!=='all' && p.cat!==filterCat) return false; if(qlow && !(p.title.toLowerCase().includes(qlow)||p.desc.toLowerCase().includes(qlow))) return false; return true })
      list.forEach(p=>{
        const el=document.createElement('div'); el.className='product card';
        el.innerHTML = `
          <div class="image"><img src="${p.img}" alt="${p.title}" style="max-height:200px;object-fit:cover"></div>
          <div class="body">
            <h4>${p.title}</h4>
            <div class="muted">${p.cat} • ID ${p.id}</div>
            <div style="height:8px"></div>
            <div class="price">₱${money(p.price)}</div>
            <div style="height:10px"></div>
            <div style="display:flex;gap:8px">
              <button class="btn" data-id="${p.id}" onclick="openModal('${p.id}')">Quick view</button>
              <button class="chip" onclick="recordQuickSale('${p.id}',1)">Buy 1 (demo)</button>
            </div>
          </div>`;
        productsEl.appendChild(el);
      })
    }
    renderProducts();
    document.querySelectorAll('.chip[data-cat]').forEach(ch=>ch.addEventListener('click',()=>{ renderProducts(ch.dataset.cat, searchInput.value) })));
    searchInput.addEventListener('input',e=>renderProducts('all',e.target.value));

    // ---------- Product modal ----------
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalPrice = document.getElementById('modalPrice');
    const modalDesc = document.getElementById('modalDesc');
    const modalCategory = document.getElementById('modalCategory');
    const modalImage = document.getElementById('modalImage');
    const addToCartBtn = document.getElementById('addToCartBtn');
    let currentModalProduct = null;
    window.openModal = function(id){ const p = dataProducts.find(x=>x.id===id); if(!p) return; currentModalProduct=p; modalTitle.textContent=p.title; modalPrice.textContent='₱'+money(p.price); modalDesc.textContent=p.desc; modalCategory.textContent=p.cat; modalImage.innerHTML=`<img src="${p.img}" alt="${p.title}" style="max-height:320px;object-fit:cover">`; modalBackdrop.style.display='flex' }
    modalBackdrop.addEventListener('click',e=>{ if(e.target===modalBackdrop) modalBackdrop.style.display='none' })

    addToCartBtn.addEventListener('click',()=>{ const qty = Number(document.getElementById('qty').value)||1; addCart(currentModalProduct.id,qty); modalBackdrop.style.display='none' })

    // ---------- Cart logic ----------
    const cartCount = document.getElementById('cartCount');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartItems = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartSummary = document.getElementById('cartSummary');

    function saveCart(){ save(KEY_CART,cart); updateCartUI(); }
    function updateCartUI(){ const keys=Object.keys(cart); let total=0,count=0; cartItems.innerHTML=''; keys.forEach(id=>{ const p=dataProducts.find(x=>x.id===id); const qty=cart[id].qty; const el=document.createElement('div'); el.className='cart-item'; el.innerHTML=`<div style="width:56px;height:56px;overflow:hidden;border-radius:10px"><img src="${p.img}" style="width:100%;height:100%;object-fit:cover"/></div><div style="flex:1"><div style="font-weight:600">${p.title}</div><div class="muted">₱${money(p.price)} • x ${qty}</div></div><div><button class="chip" onclick="changeQty('${id}',-1)">-</button><button class="chip" onclick="changeQty('${id}',1)">+</button></div>`; cartItems.appendChild(el); total += p.price*qty; count += qty })
      cartCount.textContent = count; cartTotalEl.textContent = money(total); cartSummary.innerHTML = keys.length ? `${count} items • ₱${money(total)}` : 'No items yet.' }

    function changeQty(id,delta){ if(!cart[id]) return; cart[id].qty += delta; if(cart[id].qty<=0) delete cart[id]; saveCart(); }

    window.openCart = function(){ cartDrawer.style.display = cartDrawer.style.display === 'none' ? 'block' : 'none' }
    document.getElementById('openCartBtn').addEventListener('click',openCart);

    function addCart(id,qty=1){ cart[id]=cart[id]||{qty:0}; cart[id].qty += qty; saveCart(); alert('Added to cart') }

    // quick buy (records sale without user info) — still records an order with status 'paid' and userId if logged in
    window.recordQuickSale = function(id,q){ const today=new Date(); const monthKey = today.toISOString().slice(0,7); monthSales[monthKey]=monthSales[monthKey]||{}; monthSales[monthKey][id] = (monthSales[monthKey][id]||0) + q; const order = {id:uid(6),productId:id,qty:q,month:monthKey,status:'paid',userId: currentUser ? currentUser.id : null, created:new Date().toISOString(), address: currentUser ? currentUser.address : null, phone: currentUser ? currentUser.phone : null}; orders.push(order); save(KEY_ORDERS,orders); save(KEY_MONTH_SALES,monthSales); alert('Demo purchase recorded for ' + monthKey); renderUserOrders(); }

    // Buy now -> converts cart to order (status: pending) and requires shipping info from profile (one-time save)
    document.getElementById('buyNow').addEventListener('click',()=>{
      const keys = Object.keys(cart); if(!keys.length){alert('Cart empty');return}
      // require address & phone
      if(!currentUser){ if(!confirm('You are not logged in. Creating an account is recommended to save your address. Proceed as guest?')) return }
      const addr = currentUser ? currentUser.address : prompt('Enter shipping address:');
      const phone = currentUser ? currentUser.phone : prompt('Enter phone number:');
      if(!addr||!phone){alert('Address and phone required');return}
      const today = new Date(); const monthKey = today.toISOString().slice(0,7);
      keys.forEach(id=>{ monthSales[monthKey] = monthSales[monthKey] || {}; monthSales[monthKey][id] = (monthSales[monthKey][id]||0) + cart[id].qty; const order = {id:uid(6),productId:id,qty:cart[id].qty,month:monthKey,status:'pending',userId: currentUser ? currentUser.id : null, created:new Date().toISOString(), address: addr, phone: phone}; orders.push(order); });
      save(KEY_ORDERS,orders); save(KEY_MONTH_SALES,monthSales);
      // if currentUser had no address but provided one, persist it
      if(currentUser && (!currentUser.address || !currentUser.phone)){
        currentUser.address = addr; currentUser.phone = phone; const idx = users.findIndex(u=>u.id===currentUser.id); if(idx>-1){ users[idx].address = addr; users[idx].phone = phone; save(KEY_USERS,users)} save(KEY_CURRENT_USER,currentUser); updateProfileArea();
      }
      cart = {}; saveCart(); cartDrawer.style.display='none'; alert('Order placed (demo). Status: pending. Track in Order History'); renderAdminOrders(); renderUserOrders();
    })

    document.getElementById('checkoutBtn').addEventListener('click',()=>{ openCart(); window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}) })
    updateCartUI();

    // ---------- Admin functions ----------
    const adminModal = document.getElementById('adminModal');
    const openAdmin = document.getElementById('openAdmin');
    const adminProduct = document.getElementById('adminProduct');
    const recordSaleBtn = document.getElementById('recordSale');
    const adminOrdersEl = document.getElementById('adminOrders');
    const adminOrderList = document.getElementById('adminOrderList');
    const adminFilter = document.getElementById('adminFilter');

    function refreshAdminProducts(){ adminProduct.innerHTML=''; dataProducts.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=`${p.title} (₱${money(p.price)})`; adminProduct.appendChild(o) }) }
    refreshAdminProducts();

    openAdmin.addEventListener('click',()=>{ adminModal.style.display='flex'; renderAdminOrders(); document.getElementById('adminMonth').value = new Date().toISOString().slice(0,7) })
    adminModal.addEventListener('click',e=>{ if(e.target===adminModal) adminModal.style.display='none' })

    recordSaleBtn.addEventListener('click',()=>{
      const id = adminProduct.value; const qty = Number(document.getElementById('adminQty').value)||1; const month = document.getElementById('adminMonth').value; if(!month){alert('Pick month');return}
      monthSales[month] = monthSales[month] || {}; monthSales[month][id] = (monthSales[month][id]||0) + qty; orders.push({id:uid(6),productId:id,qty:qty,month:month,status:'paid',userId:null,created:new Date().toISOString(),address:null,phone:null}); save(KEY_ORDERS,orders); save(KEY_MONTH_SALES,monthSales); renderAdminOrders(); alert('Recorded');
    })

    function renderAdminOrders(){ adminOrdersEl.innerHTML=''; const recent = orders.slice(-10).reverse(); recent.forEach(o=>{ const p = dataProducts.find(x=>x.id===o.productId)||{title:o.productId}; const d = document.createElement('div'); d.className='muted'; d.style.padding='6px 0'; d.textContent = `${o.created.split('T')[0]} — ${p.title} x ${o.qty} — ${o.status}`; adminOrdersEl.appendChild(d) }); renderAdminOrderList(); }

    function renderAdminOrderList(){ adminOrderList.innerHTML=''; const f = adminFilter.value; const list = orders.filter(o=> f==='all' ? true : o.status===f ); list.slice().reverse().forEach(o=>{ const p = dataProducts.find(x=>x.id===o.productId)||{title:o.productId}; const div = document.createElement('div'); div.style.padding='8px;borderBottom='; div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${p.title}</strong><div class="muted">Order ${o.id} • ${o.qty} pcs • ${o.created.split('T')[0]}</div><div class="muted">${o.address?o.address:'No address'} • ${o.phone||''}</div></div><div style="display:flex;flex-direction:column;gap:6px"><select data-order="${o.id}"><option value="pending">pending</option><option value="paid">paid</option><option value="delivered">delivered</option></select><button class="chip" data-id="${o.id}">View</button></div></div>`; adminOrderList.appendChild(div); const sel = div.querySelector('select'); sel.value = o.status; sel.addEventListener('change',e=>{ updateOrderStatus(o.id, e.target.value) }); div.querySelector('button').addEventListener('click',()=>{ alert(JSON.stringify(o,null,2)) }) }) }

    adminFilter.addEventListener('change',renderAdminOrderList);

    function updateOrderStatus(orderId,status){ const idx = orders.findIndex(o=>o.id===orderId); if(idx===-1) return; orders[idx].status = status; save(KEY_ORDERS,orders); renderAdminOrders(); renderUserOrders(); alert('Order status updated') }

    document.getElementById('resetData').addEventListener('click',()=>{ if(confirm('Reset demo orders and sales?')){ orders=[]; monthSales={}; save(KEY_ORDERS,orders); save(KEY_MONTH_SALES,monthSales); renderAdminOrders(); renderUserOrders(); alert('Reset') } })

    document.getElementById('exportData').addEventListener('click',()=>{ const blob = new Blob([JSON.stringify({products:dataProducts,users:users,orders:orders,monthSales:monthSales},null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='five-queens-data.json'; a.click(); URL.revokeObjectURL(url); })

    // ---------- Reports (best seller) ----------
    const reportModal = document.getElementById('reportModal');
    const reportMonth = document.getElementById('reportMonth');
    const reportContent = document.getElementById('reportContent');

    document.getElementById('openReport').addEventListener('click',()=>{ reportModal.style.display='flex'; reportMonth.value = new Date().toISOString().slice(0,7); renderReport() })
    reportModal.addEventListener('click',e=>{ if(e.target===reportModal) reportModal.style.display='none' })
    reportMonth.addEventListener('change',renderReport);

    function renderReport(){ const m = reportMonth.value || new Date().toISOString().slice(0,7); const sales = monthSales[m] || {}; if(!Object.keys(sales||{}).length){ reportContent.innerHTML = `<div class="muted">No sales recorded for ${m}.</div>`; return } const arr = Object.entries(sales).map(([pid,c])=>({pid,count:c})); arr.sort((a,b)=>b.count-a.count); const top = arr[0]; const ptop = dataProducts.find(x=>x.id===top.pid); let html = `<div style="display:flex;gap:12px;align-items:center"><div style="width:120px;height:120px;border-radius:12px;overflow:hidden"><img src="${ptop.img}" style="width:100%;height:100%;object-fit:cover"/></div><div><h3>${ptop.title}</h3><div class="muted">Sold ${top.count} pcs in ${m}</div><div style="height:8px"></div><div class="muted">Category: ${ptop.cat}</div></div></div>`; html += `<div style="margin-top:12px"><h4>Top sellers</h4><ol>` + arr.slice(0,5).map(a=>{const p=dataProducts.find(x=>x.id===a.pid); return `<li>${p.title} — ${a.count} pcs`}).join('') + `</ol></div>`; reportContent.innerHTML = html }

    // ---------- User order history & tracking ----------
    function renderUserOrders(){ const section = document.getElementById('userOrdersSection'); if(!currentUser){ section.innerHTML = `<div class="card"><h4>Order History</h4><div class="muted">Login to view your orders. Orders placed as guest will not be tied to an account.</div></div>`; return } const my = orders.filter(o=>o.userId===currentUser.id); let html = `<div class="card"><h4>Order History (${my.length})</h4>`; if(!my.length){ html += `<div class="muted">No orders yet.</div>` } else { html += `<div style="display:flex;flex-direction:column;gap:8px">`+ my.slice().reverse().map(o=>{ const p = dataProducts.find(x=>x.id===o.productId) || {title:o.productId}; return `<div style="padding:10px;border:1px solid #f3e3e8;border-radius:10px;display:flex;justify-content:space-between;align-items:center"><div><strong>${p.title}</strong><div class="muted">Order ${o.id} • ${o.qty} pcs • ${o.created.split('T')[0]}</div><div class="muted">Status: ${o.status}</div><div class="muted">Address: ${o.address||'—'}</div></div><div><button class="chip" onclick="trackOrder('${o.id}')">Track</button></div></div>` }).join('') + `</div>` } html += `</div>`; section.innerHTML = html }

    window.trackOrder = function(orderId){ const o = orders.find(x=>x.id===orderId); if(!o){alert('Order not found')} else { alert(`Order ${o.id}
Product: ${ (dataProducts.find(p=>p.id===o.productId)||{title:o.productId}).title }
Qty: ${o.qty}
Status: ${o.status}
Placed: ${o.created}
Address: ${o.address||'—'}`) } }

    renderUserOrders();

    // ---------- Utilities ----------
    function loadEverything(){ dataProducts = load(KEY_PRODUCTS, demoProducts); users = load(KEY_USERS,[]); orders = load(KEY_ORDERS,[]); monthSales = load(KEY_MONTH_SALES,{}); cart = load(KEY_CART,{}); currentUser = load(KEY_CURRENT_USER,null); refreshAdminProducts(); renderProducts(); updateCartUI(); updateProfileArea(); renderAdminOrders(); renderUserOrders(); }
    loadEverything();

    // ---------- Tip for first-time ----------
    if(!localStorage.getItem('fq_seen_tip')){ localStorage.setItem('fq_seen_tip','1'); setTimeout(()=>alert('Tip: Register an account to save your address and track orders. Admin → Record Sales to simulate orders.'),600) }

    // ---------- Expose some functions to global for inline handlers ----------
    window.renderUserOrders = renderUserOrders;
    window.renderAdminOrders = renderAdminOrders;
    window.renderAdminOrderList = renderAdminOrderList;

  </script>
</body>
</html>
